/*!
 * Twinstone TDI (https://github.com/twinstone/tdi)
 * Version: 1.9.5
 *
 * Copyright Etnetera a.s. https://www.etnetera.cz
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(){"use strict";function t(t,e){for(var n=t.split("."),a=e.split("."),r=0;r<3;r++){var i=Number(n[r]),o=Number(a[r]);if(i>o)return 1;if(o>i)return-1;if(!isNaN(i)&&isNaN(o))return 1;if(isNaN(i)&&!isNaN(o))return-1}return 0}if(void 0===jQuery)throw"Missing dependency: jQuery!";if(t(jQuery.fn.jquery,"1.10.2")<0)try{console.log("Recommended version of jQuery is 1.10.2 or higher."),console.log("See: https://github.com/twinstone/tdi/issues/8"),console.log("See: https://bugs.jquery.com/ticket/13936")}catch(e){}window.TDI=function(){return{}}()}(),function(t){"use strict";t.Ajax=function(){function e(){$(document).on("submit",c.formSubmit,i).on("click",c.linkClick,a).on("click",c.formButtonActivate,s).on("change",c.fieldChange,d).on("keydown",c.fieldSubmit,u),$(window).on("unload",n),$.event.special["tdi:ajax:beforeLinkClick"]={_default:r},$.event.special["tdi:ajax:beforeFormSubmit"]={_default:o}}function n(t){$(document).off("click",c.linkClick,r).off("submit",c.formSubmit,i).off("click",c.formButtonActivate,s).off("change",c.fieldChange,d).off("keydown",c.fieldSubmit,u)}function a(t){var e=$(t.currentTarget);t.ctrlKey||t.metaKey||t.shiftKey||t.button&&1===t.button||(t.preventDefault(),e.trigger("tdi:ajax:beforeLinkClick",{link:e}))}function r(e){t.Ajax.send(e.target)}function i(t){var e=$(t.currentTarget);t.preventDefault(),e.trigger("tdi:ajax:beforeFormSubmit",{form:e})}function o(e){t.Ajax.send(e.target)}function s(t){var e=t.currentTarget,n=$(e),a=$(e.form);a.data("_submitButton",n),n.attr("name")&&(a.find("input.submit-action").remove(),$("<input>").attr("type","hidden").attr("name",n.attr("name")).attr("value",n.attr("value")).addClass("submit-action").appendTo(a))}function d(e){var n=e.currentTarget;$(n).data("ajax-url")?t.Ajax.send(n):$(n.form).submit()}function u(e){var n=e.currentTarget;13===e.keyCode&&(e.preventDefault(),$(n).data("ajax-url")?t.Ajax.send(n):$(n.form).submit())}var c={linkClick:["a.ajaxlink","a.tdi","a.infuse"].join(","),formSubmit:["form.ajaxform","form.tdi","form.infuse"].join(","),formButtonActivate:["form.ajaxform [type=submit]","form.tdi [type=submit]","form.infuse [type=submit]"].join(","),fieldChange:["select.ajaxselect","select.tdi","select.infuse","input[type=checkbox].tdi","input[type=checkbox].infuse","input[type=radio].tdi","input[type=radio].infuse"].join(","),fieldSubmit:["input[type=text].tdi","input[type=text].infuse"].join(",")};return e(),{send:function(e,n){n=n||{};var a=$(e),r=a.attr("name"),i=a.val(),o=a.data("confirm"),s=a.closest(a.data("related-ancestor")||"").add($(a.data("related-element")||"")).add($(a.attr("rel")||"")).add($(a.data("_submitButton")||"")),d=a.add(s),u=$(a.data("trigger-group")||""),c=a.data("ajax-url")||a.attr("href")||a.attr("action"),p=a.data("ajax-method")||a.attr("method"),f=a.data("ajax-xhr-fields")||{},l={};if(""!==c&&void 0!==c||!i||(c=i),r&&i&&(a.is("input[type=checkbox]")&&a.prop("checked")===!1?l[r]=0:l[r]=i),!a.is("[disabled], .disabled")&&(!o||window.confirm(o))){var m={beforeStart:function(){var t=n.beforeStart&&n.beforeStart.apply(this,arguments);return("undefined"==typeof t||t===!0)&&(d.addClass("loading"),u.each(function(t,e){e.hasClass("disabled")||e.prop("disabled")||(e.addClass("disabled").prop("disabled",!0),e.data("_disabled",!0))}),s.get(0)&&s.addClass("loading-target"),n.start&&n.start.apply(this,arguments),!0)},beforeEnd:function(){var t=n.beforeEnd&&n.beforeEnd.apply(this,arguments);"undefined"!=typeof t&&t!==!0||(d.removeClass("loading"),u.each(function(t,e){e.data("_disabled")===!0&&(e.removeClass("disabled").prop("disabled",!1),e.data("_disabled",!1))}),s.get(0)&&s.removeClass("loading-target"),n.end&&n.end.apply(this,arguments))},data:l,method:p,trigger:a,involvedElms:d,xhrFields:f};return a.is("form")?(m.end=function(){a.data("_submitButton",null),a.find("input.submit-action").remove()},t.Ajax.Request.sendForm(a,m)):t.Ajax.Request.send(c,m)}}}}(),t.Ajax.Request=function(){var e=function(){var t=new XMLHttpRequest;return!!(t&&"upload"in t&&"onprogress"in t.upload)}(),n=!!window.FormData;return{send:function(e,n){n=n||{},n.url=t.Ajax.Request.ajaxifyUrl(e),n.xhrFields=n.xhrFields||{},n.type=n.type||n.method||"GET",n.async=!n.sync,n.data=n.data||"",n.dataType=n.dataType||"xml";var a=$.extend({},n);return a.beforeSend=function(t,e){var a=n.beforeStart&&n.beforeStart(t,e,n);return("undefined"==typeof a||a===!0)&&($(document).trigger("tdi:ajax:_start",{xhr:t,settings:e,options:n}),n.start&&n.start(t,e,n),!0)},a.success=function(t,e,a){$(document).trigger("tdi:ajax:_success",{data:t,textStatus:e,xhr:a,options:n}),n.success&&n.success(t,e,a,n)},a.error=function(t,e,a){$(document).trigger("tdi:ajax:_error",{xhr:t,textStatus:e,error:a,options:n}),n.error&&n.error(t,e,a,n)},a.complete=function(t,e){var a=n.beforeEnd&&n.beforeEnd(t,e,n);"undefined"!=typeof a&&a!==!0||($(document).trigger("tdi:ajax:_end",{xhr:t,textStatus:e,options:n}),n.end&&n.end(t,e,n))},$.ajax(a)},sendForm:function(a,r){r=r||{};var i=$(a),o=i.data("_submitButton"),s=i.data("ajax-url")||i.attr("action");if(i.attr("enctype")||i.attr("enctype","application/x-www-form-urlencoded"),r.contentType=i.attr("enctype")+"; charset=UTF-8",r.method=r.method||i.attr("method"),!(i.find("input[type=file]").length>0))return r.data=i.serialize(),t.Ajax.Request.send(s,r);if(r.method="post",i.attr("enctype","multipart/form-data"),r.contentType=i.attr("enctype")+"; charset=UTF-8",e&&n)return r.data=new FormData(i.get(0)),r.processData=!1,r.contentType=!1,t.Ajax.Request.send(s,r);r.url=t.Ajax.Request.ajaxifyUrl(s);var d=r.beforeStart&&r.beforeStart(i,r);if(d===!1)return!1;$(document).trigger("tdi:ajax:_start",{xhr:i,settings:null,options:r}),r.start&&r.start(i,r),o&&o.addClass("loading");var u,c="form_iframe_"+(new Date).getTime();return document.documentMode&&document.documentMode<=8?u=document.createElement('<iframe name="'+c+'">'):(u=document.createElement("iframe"),u.name=c),u.style.display="none",document.body.appendChild(u),$(u).load(function(){var t=this.contentWindow.document.XMLDocument||this.contentWindow.document,e={responseXML:t,responseText:t.body?t.getElementsByTagName("html")[0].innerHTML:null},n=r.beforeEnd&&r.beforeEnd(i,r,t);return n!==!1&&(o&&o.removeClass("loading"),$(document).trigger("tdi:ajax:_success",{data:t,textStatus:"",xhr:e,options:r}),$(document).trigger("tdi:ajax:_end",{xhr:i,textStatus:null,options:r}),i.trigger("tdi:ajax:_formSubmit",{form:i,options:r,xhr:e,data:t}),r.end&&r.end(i,r,t),void setTimeout(function(){$(u).off().remove(),i.removeAttr("target")},1e4))}),i.attr("action",r.url),i.attr("method",r.method||"post"),i.attr("target",c),i.attr("enctype","multipart/form-data"),i[0].submit(),null},ajaxifyUrl:function(t){var e="_infuse=1&_ts="+(new Date).getTime();return t.indexOf("?#")>=0?t.replace(/\?#/,"?"+e+"#"):t.indexOf("&#")>0?t.replace(/&#/,"&"+e+"#"):t.indexOf("?")>=0?t.replace(/\?/,"?"+e+"&"):t.indexOf("#")>=0?t.replace(/#/,"?"+e+"#"):t+"?"+e}}}(),t.Ajax.Response=function(){function e(t,e,n){t.trigger("tdi:ajax:updatesDone",[{updates:e,options:n}])}function n(t,e,n){t.trigger("tdi:ajax:insertsDone",[{inserts:e,options:n}])}function a(t,e,n){t.trigger("tdi:ajax:scriptsDone",[{scripts:e,options:n}])}function r(t,e,n){t.trigger("tdi:ajax:stylesDone",[{styles:e,options:n}])}function i(t,e,n){t.trigger("tdi:ajax:popupsDone",[{popups:e,options:n}])}function o(t,e,n){t.trigger("tdi:ajax:unknownsDone",[{unknowns:e,options:n}])}function s(t,e,n){t.trigger("tdi:ajax:done",[{responses:e,options:n}])}function d(t,e,n){F=!1,$(n.involvedElms||document).trigger("tdi:ajax:start",[{xhr:t,options:n,settings:e}])}function u(t,d,u,p){if(!t)return c(u,d,null,p),!1;var f,l=$(t),g=l.find("status");"ok"!==g.text().toLowerCase()&&c(u,d,g.text(),p),l.find("response > *:not(status)").each(function(){var t=this.tagName.toLowerCase();switch(t){case"script":I.push(this);break;default:N[t]?N[t](this,p):b(this,p)}});var x=$(p.involvedElms).filter(function(t,e){return document.body?document.body.contains(e):document.contains(e)});0===x.length&&(x=$(document)),e(x,R.updates,p),n(x,R.inserts,p),r(x,R.styles,p),i(x,R.popups,p),o(x,R.unknowns,p),I.length?(f=window.setInterval(function(){F&&(window.clearInterval(f),a(x,R.scripts,p),s(x,R,p))},100),m(I.shift(),p)):s(x,R,p)}function c(t,e,n,a){$(document).trigger("tdi:ajax:error",[{status:t?t.status:"N/A",message:n||"Invalid Ajax response. The response must be a valid XML.",xhr:t,textStatus:e,options:a}])}function p(t,e,n){$(n.involvedElms||document).trigger("tdi:ajax:end",[{options:n}])}function f(t,e){if(!t)return!1;var n=$(t),a=n.attr("target"),r=n.attr("selector"),i=r?$(r):$(document.getElementById(a)),o=$.trim(n.text()),s=n.attr("replace"),d=n.attr("append"),u=n.attr("prepend"),c=n.attr("class-add")||"",p=n.attr("class-remove")||"",f={target_id:a,selector:r,target:i,content:o,content_empty:0===o.replace(/\&nbsp;/g,"").length,replace:s,append:d,prepend:u,class_add:c,class_remove:p,options:e,tag:n};i.length>0&&(i.first().trigger("tdi:ajax:beforeUpdate",f),R.updates.push(f))}function l(t,e){if(!t)return!1;var n,a=$(t),r=a.attr("target"),i=a.attr("selector"),o=i?$(i):$(document.getElementById(r)),s=$.trim(a.text()),d=a.attr("position")||"after",u={target_id:r,selector:i,target:o,content:s,position:d,inserted_node:n,options:e,tag:a};o.length>0&&(o.first().trigger("tdi:ajax:beforeInsert",u),R.inserts.push(u))}function m(t,e){if(!t)return!1;var n=$(t),a=$.trim(n.text()),r=n.attr("src"),i=n.attr("id"),o={script_src:r,script_data:a,script_id:i,options:e,tag:n};R.scripts.push(o),$(document).trigger("tdi:ajax:beforeScript",o)}function g(t,e){if(!t)return!1;var n=$(t),a=n.attr("src"),r=n.attr("id"),i={style_src:a,style_id:r,options:e,tag:n};$(document).trigger("tdi:ajax:beforeStyle",i),R.styles.push(i)}function x(t,e){if(!t)return!1;var n=$(t),a={options:e,tag:n};$(document).trigger("tdi:ajax:beforeReload",a)}function h(t,e){if(!t)return!1;var n=$(t),a={href:n.attr("href"),options:e,tag:n};a.href&&$(document).trigger("tdi:ajax:beforeRedirect",a)}function y(t,e){if(!t)return!1;var n=$(t),a=n.attr("mode")||"popup",r=n.attr("href"),i=n.attr("width")||600,o=n.attr("height")||500,s={href:r,mode:a,width:parseInt(i),height:parseInt(o),options:e,tag:n};r&&($(document).trigger("tdi:ajax:beforePopup",s),R.popups.push(s))}function b(t,e){if(!t)return!1;for(var n=$(t),a=t.tagName.toLowerCase(),r=a.substr(0,1).toUpperCase()+a.substr(1),i=t.attributes,o={_name:a,contents:$.trim(n.text()),options:e,tag:n},s=0,d=i.length;s<d;s++)o[i[s].name]=i[s].value;$.event.special["tdi:ajax:before"+r]={_default:D},$(document).trigger("tdi:ajax:before"+r,o),R.unknowns.push(o)}function j(t,e){var n;e.target.removeClass(e.class_remove).addClass(e.class_add),"true"===e.replace?(n=$(e.content),e.target.find("*").addBack().off(),e.target.replaceWith(n),e.target=n):"true"===e.append?e.target.append(e.content):"true"===e.prepend?e.target.prepend(e.content):(e.target.find("*").off(),e.target.html(e.content)),e.target.first().trigger("tdi:ajax:update",e)}function v(t,e){e.inserted_node=$(e.content)["before"===e.position?"insertBefore":"insertAfter"](e.target),e.target.trigger("tdi:ajax:insert",e)}function _(e,n){var a=I,r=!0,i=function(t){var e;n.script_data&&(e=document.createElement("script"),e.type="text/javascript",e.text=n.script_data,n.script_id&&(e.id=n.script_id+"_inline"),document.getElementsByTagName("head")[0].appendChild(e)),n.script_node=t,n.script_node_inline=e,$(document).trigger("tdi:ajax:script",n),a.length?m(a.shift()):F=!0};n.script_src?(n.script_id&&document.getElementById(n.script_id)&&(r=!1),r&&t.Tools.getScript(n.script_src,{id:n.script_id,complete:i})):i()}function w(e,n){var a=!0;n.style_id&&document.getElementById(n.style_id)&&(a=!1),a&&t.Tools.getStyle(n.style_src,{id:n.style_id,complete:function(t){n.style_node=t,$(document).trigger("tdi:ajax:style",n)}})}function S(t,e){window.location.reload(!0)}function k(t,e){window.location.assign(e.href)}function T(t,e){var n="";"dialog"===e.mode&&(n+="width="+e.width+", height="+e.height),e.popup=window.open(e.href,"_blank",n),$(document).trigger("tdi:ajax:popup",e)}function C(t,e){$(document).trigger("tdi:ajax:"+e._name,e)}var E,A,D,B,N,I,R,F;$(document).on("tdi:ajax:_start",function(t,e){d(e.xhr,e.settings,e.options)}),$(document).on("tdi:ajax:_success",function(t,e){u(e.data,e.textStatus,e.xhr,e.options)}),$(document).on("tdi:ajax:_error",function(t,e){c(e.xhr,e.textStatus,e.error,e.options)}),$(document).on("tdi:ajax:_end",function(t,e){p(e.xhr,e.textStatus,e.options)}),N={update:f,insert:l,script:m,style:g,reload:x,redirect:h,popup:y},I=[],R={updates:[],inserts:[],scripts:[],styles:[],popups:[],unknowns:[]},A={"tdi:ajax:beforeUpdate":j,"tdi:ajax:beforeInsert":v,"tdi:ajax:beforeScript":_,"tdi:ajax:beforeStyle":w,"tdi:ajax:beforeReload":S,"tdi:ajax:beforeRedirect":k,"tdi:ajax:beforePopup":T},D=function(t,e){A[t.type]?A[t.type].call(this,t,$.isArray(e)?e[1]:e):C.call(this,t,$.isArray(e)?e[1]:e)},B=function(t){switch(t.type){case"tdi:ajax:beforeScript":F=!0}};for(E in A)$.event.special[E]={_default:D,postDispatch:B};return{}}()}(window.TDI),function(t){"use strict";t.Tools={getScript:function(t,e){var n,a=!1;t&&(e=e||{},n=document.createElement("script"),n.type="text/javascript",n.src=t,e.id&&(n.id=e.id),e.complete&&(n.onreadystatechange=function(){var t=this.readyState;a||"loaded"!==t&&"complete"!==t||(a=!0,n.onreadystatechange=null,e.complete(n))},n.onload=function(){a||(a=!0,e.complete(n))}),document.getElementsByTagName("head")[0].appendChild(n))},getStyle:function(t,e){var n;t&&(e=e||{},n=document.createElement("link"),n.rel="stylesheet",n.type="text/css",n.media=e.media||"screen",n.href=t,e.id&&(n.id=e.id),document.getElementsByTagName("head")[0].appendChild(n),e.complete&&e.complete(n))}}}(window.TDI);